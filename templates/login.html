<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FocusRO - Login</title>
  <link rel="stylesheet" href="./static/login.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<body onload="checkDatabase()">

  <div class="container">
    <div class="window-header">
      <!-- <div class="window-title">
        <span>FocusRO</span>
      </div> -->
      <div class="window-controls">
        <div class="window-button minimize">−</div>
        <div class="window-button maximize">□</div>
        <div class="window-button close">×</div>
      </div>
    </div>

    <div class="wave-bg"></div>

    <div class="logo">
      <img src="./static/logo.webp" alt="DDS Logo" width="340px" height="auto">
    </div>

    <div class="content">
      <div class="title">Automated Employee Monitoring Software</div>
      <div class="subtitle">Machine learning-based productivity & distraction detection</div>

      <div class="login-form">
        <input type="text" class="input-field" placeholder="Username or Email" id="username" autocomplete="username" />
        <input type="password" class="input-field" placeholder="Password" id="password"
          autocomplete="current-password" />
     



        <div class="checkbox-container">
             <div class="input-group">
  <input type="checkbox" id="rememberMe" />
  <label for="rememberMe" id="rememberMeLabel" style="color:white;">Remember Me</label>
</div>
          <!-- <label class="save-password">
            <input type="checkbox" id="savePassword" /> 
            <span>Save Password</span>
          </label> -->
          <!-- <a href="https://crm.deluxebilisim.com/admin/authentication/forgot_password" class="forgot-password">Forgot Password?</a> -->
       <a href="https://crm.deluxebilisim.com/admin/authentication/forgot_password" 
   target="_blank" 
   rel="noopener noreferrer" 
   class="forgot-password">
   Forgot Password?
</a>
        </div>

        <button class="login-button" id="loginBtn" onclick="handleLogin()">LOGIN</button>
        <!-- <button class="guest-button" onclick="guestLogin()">Login as Guest</button> -->
      </div>
    </div>


    <div class="language-selector">
      <select id="languageSelector" onchange="changeLanguage()">
        <option value="en">English</option>
        <option value="tr">Turkish</option>
      </select>
    </div>

    <div class="version">DeluxeTime v1.3</div>
  </div>

  <!-- Staff Data Display -->
  <div class="staff-data">
    <h3>Staff Data:</h3>
    <ul id="staffList"></ul>
  </div>

  
  <!-- Scripts Section -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <script>
    let staffData = []; // Store staff data globally

    function fetchStaffData() {
      fetch('/get-staff-data')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            console.log("Staff Data:", data.staff_data);
            staffData = data.staff_data;  // Store staff data in a global variable

            // Clear existing list items
            const staffList = document.getElementById('staffList');
            staffList.innerHTML = '';

            // Loop through the staff data and display it in a list
            data.staff_data.forEach(staff => {
              const listItem = document.createElement('li');
              listItem.textContent = `${staff.name} - ${staff.position}`;
              staffList.appendChild(listItem);
            });
          } else {
            console.error("Failed to fetch staff data:", data.message);
          }
        })
        .catch(error => {
          console.error("Error fetching staff data:", error);
        });
    }

    function checkDatabase() {
      fetch('/check-db-connection')
        .then(response => response.json())
        .then(data => {
          console.log("Database connection check response:", data);
          if (data.status === 'success') {
            Toastify({
              text: "Login Page",
              backgroundColor: "green",
              duration: 3000
            }).showToast();
          } else {
            Toastify({
              text: `Error: ${data.message}`,
              backgroundColor: "red",
              duration: 3000
            }).showToast();
          }
        })
        .catch(() => {
          Toastify({
            text: "Error checking database connection.",
            backgroundColor: "red",
            duration: 3000
          }).showToast();
        });
    }

    const translations = {
      en: {
        title: "Automated Employee Monitoring Software",
        subtitle: "Machine learning-based productivity & distraction detection",
        usernamePlaceholder: "Username or Email",
        rememberMe: "Remember Me",
        passwordPlaceholder: "Password",
        savePassword: "Save Password",
        forgotPassword: "Forgot Password?",
        loginButton: "LOGIN",
        guestButton: "Login as Guest",
        staffData: "Staff Data:",
        version: "DeluxeTime v1.3.0"
      },
      tr: {
        title: "İş Emri Takip Yazılımı",
        subtitle: " ",
        usernamePlaceholder: "Kullanıcı Adı veya E-posta",
        passwordPlaceholder: "Şifre",
        savePassword: "Şifreyi Kaydet",
        rememberMe: "Şifreyi Kaydet", 
        forgotPassword: "Şifremi Unuttum?",
        loginButton: "GİRİŞ",
        guestButton: "Misafir Olarak Giriş Yap",
        staffData: "Personel Verileri:",
        version: "DeluxeTime v1.3.0"
      }
    };

















function changeLanguage() {
  const selectedLanguage = document.getElementById("languageSelector").value;
  sessionStorage.setItem('selectedLanguage', selectedLanguage);  // ✅ Save to session

  const translation = translations[selectedLanguage];

  document.querySelector(".title").textContent = translation.title;
  document.querySelector(".subtitle").textContent = translation.subtitle;
  document.getElementById("username").placeholder = translation.usernamePlaceholder;
  document.getElementById("password").placeholder = translation.passwordPlaceholder;
  document.querySelector(".forgot-password").textContent = translation.forgotPassword;
  document.getElementById("loginBtn").textContent = translation.loginButton;
  document.querySelector(".staff-data h3").textContent = translation.staffData;
  document.querySelector(".version").textContent = translation.version;
  // document.getElementById("rememberMeLabel").textContent = translation.savePassword;
  document.getElementById("rememberMeLabel").textContent = translation.rememberMe;
}


















    async function handleLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (!username || !password) {
        Toastify({
          text: "Please enter both username and password",
          backgroundColor: "red",
          duration: 3000
        }).showToast();
        return;
      }

      // Check if the email exists in the staff data
      const user = staffData.find(staff => staff.email === username);
      if (!user) {
        Toastify({
          text: "Email not found in staff data",
          backgroundColor: "red",  // Red for error
          duration: 3000
        }).showToast();
        return;
      }

      // If email exists, show "User is available" toast
      Toastify({
        text: `User is available:`,
        backgroundColor: "green",  // Green for success
        duration: 3000
      }).showToast();

      // Store first name, last name, profile image, and other details in sessionStorage
      sessionStorage.setItem('user', JSON.stringify({
        firstName: user.firstname,
        lastName: user.lastname,
        profileImage: user.profile_image,
        email: user.email,
        position: user.position, // Store additional fields here
        staffid: user.staffid // Staff ID
      }));

      // Compare the password directly without encryption
      if (user.password != password) {
        Toastify({
          text: "Login successful!",
          backgroundColor: "green",  // Green for success
          duration: 3000
        }).showToast();



        if (document.getElementById("rememberMe").checked) {
        localStorage.setItem("savedUsername", username);
        localStorage.setItem("savedPassword", password);
        localStorage.setItem("rememberMe", "true");
        } else {
          localStorage.removeItem("savedUsername");
          localStorage.removeItem("savedPassword");
          localStorage.setItem("rememberMe", "false");
          }

        // Redirect to client.html after successful login
        window.location.href = 'client';  // Fixed redirection to client.html
      } else {
        Toastify({
          text: "Invalid password",  // Red for error
          backgroundColor: "red",
          duration: 3000
        }).showToast();
      }
    }

    window.onload = function () {
      checkDatabase();
      fetchStaffData();
      let defaultLang = sessionStorage.getItem('selectedLanguage') || 'tr';
      document.getElementById("languageSelector").value = defaultLang;
      changeLanguage(defaultLang); // Apply Turkish or saved language

    const savedUsername = localStorage.getItem("savedUsername");
    const savedPassword = localStorage.getItem("savedPassword");
    const rememberMe = localStorage.getItem("rememberMe");

    if (rememberMe === "true") {
      document.getElementById("username").value = savedUsername || '';
      document.getElementById("password").value = savedPassword || '';
      document.getElementById("rememberMe").checked = true;
    }

  };

  async function login() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const remember = document.getElementById("rememberMe").checked;

    if (remember) {
      localStorage.setItem("savedEmail", email);
      localStorage.setItem("savedPassword", password);
      localStorage.setItem("rememberMe", "true");
    } else {
      localStorage.removeItem("savedEmail");
      localStorage.removeItem("savedPassword");
      localStorage.setItem("rememberMe", "false");
    }
    };
  </script>

</body>

</html>